## Запуск ВК бота и основная логика его работы

### Для запуска бота на PC необходимо (ОС Windows):

1. Клонировать данный репозиторий: `git clone git@github.com:s-alex-developer/Group_work_VKinder.git`
   
2. Из файла **requirements.txt** установить виртуальное окружение: `pip install -r requirements.txt`

3. Создать базу данных, например: **VKinder_db** (_имя по умолчанию в файле **.env**_)
   
4. Заполнить файл с переменными окружения **.env** - шаблон для данного проекта доступен для скачивания ниже.

6. Для запуска ВК бота будет необходимо:
   - Получить ключ доступа к сообществу, от имени которой будет общаться бот.
   - Получить токен разработчика "ВКонтакте" [dev.vk](https://dev.vk.com/)

7. Создать необходимые для работы бота таблицы в базе данных:
   
   * Для этого необходимо запустить модуль `db_models.py`
   * При первом запуске вызов функции `delete_tables()` необходимо закомментировать. (116-ая строка модуля).
   * Последующие запуски модуля в процессе тестирования и проверки необходимо выполнять с функцией `delete_tables()`

### Логика работы нашего ВК бота:

1. В процессе общения ВК бота и пользователя вы получаем данные, которые будут составлять основные параметры поиска профилей пользователей СС "ВКонтакте":
   - Город
   - Пол
   - Возрастной диапазон

2. Реализована проверка на корректность предоставляемых данных, нельзя передать в запрос несуществующий город или возрастной диапазон если он не соответсвует предложенному шаблону.

3. При ошибочном вводе пользователю будет предложено повторить попытку ввода.

4. Общение с пользователем ВК реализовано функцией `send_some_msg` (модуль **VKinder_bot.py**)

5. Функции `get_user_name_from_vk_id` и `cleans_all_tag_from_str` - позволяют используя id пользователся, который ведет общение с ботом, получить его имя и использовать процессе дальнейшего общения в чате сообщества.

6. В результате предварительного этапа общения пользователя и ВК боты у нас формируется следующий формат данных для запроса:

   ```python
   {'user_id': ..., 'city': type_str, 'sex': ..., 'age_from': ..., 'age_to': ...}
   ```

8. Данный словарь мы передаем в качестве аргумента в функцию `get_city_id` (модуль **vk_api.py**), чтобы заменить название города, на его id в БД "ВКонтакте".
   Это будет необходимо для последующего запроса через VK API.

9. Теперь данные для запроса выглядят следующим образом:
   
    ```python
   {'user_id': ..., 'city': type_int, 'sex': ..., 'age_from': ..., 'age_to': ...}
    ```
    
10. Обновленный словарь мы передаем в функцию `search_profiles` (модуль **vk_api.py**)
    - В данном модуле выполняются `get`-запросы через `VK API` и мы получаем данные профилей, которые подходят под критерии подбора, заданные пользователем ВК.
    - Дополнительно мы установили в качестве параметров поиска "открытый профиль" и "наличие хотя бы одной фотографии в профиле".
    - В результате выполнения и обработки запросов мы получаем список словарей, имеющий следующую структуру:

      ```python
      {'first_name': ...,
      'last_name': ...,
      'photo_href_1': None,
      'photo_href_2': None,
      'photo_href_3': None,
      'result_id': ...,
      'user_id': ...,
      'vk_profile_href': ...}
      ```
    - Так же внутри данной функции реализован генератор.

11. 
   
